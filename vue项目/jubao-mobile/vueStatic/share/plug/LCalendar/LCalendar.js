window.LCalendar=function(){var e=function(){this.gearDate,this.minY=1900,this.minM=1,this.minD=1,this.maxY=2099,this.maxM=12,this.maxD=31};return e.prototype={init:function(e){if(this.type=e.type,this.trigger=document.querySelector(e.trigger),this.opener=document.querySelector(e.opener),null!=this.trigger.getAttribute("data-lcalendar")){var t=this.trigger.getAttribute("data-lcalendar").split(","),a=t[0].split("-");this.minY=~~a[0],this.minM=~~a[1],this.minD=~~a[2];var r=t[1].split("-");this.maxY=~~r[0],this.maxM=~~r[1],this.maxD=~~r[2]}if(e.minDate){a=e.minDate.split("-");this.minY=~~a[0],this.minM=~~a[1],this.minD=~~a[2]}if(e.maxDate){r=e.maxDate.split("-");this.maxY=~~r[0],this.maxM=~~r[1],this.maxD=~~r[2]}this.bindEvent(this.type)},bindEvent:function(e){var D=this;function v(){var e=D.maxY-D.minY+1,t=D.gearDate.querySelector(".date_yy"),a="";if(t&&t.getAttribute("val")){for(var r=parseInt(t.getAttribute("val")),d=0;d<=e-1;d++)a+="<div class='tooth'>"+(D.minY+d)+"</div>";t.innerHTML=a;var i=Math.floor(parseFloat(t.getAttribute("top")));if(isNaN(i))t.style["-webkit-transform"]="translate3d(0,"+(8-2*r)+"em,0)",t.setAttribute("top",8-2*r+"em");else{i%2==0?i=i:i+=1,8<i&&(i=8);var n=8-2*(e-1);i<n&&(i=n),t.style["-webkit-transform"]="translate3d(0,"+i+"em,0)",t.setAttribute("top",i+"em"),r=Math.abs(i-8)/2,t.setAttribute("val",r)}var s=D.gearDate.querySelector(".date_mm");if(s&&s.getAttribute("val")){a="";var v=parseInt(s.getAttribute("val")),l=11,c=0;r==e-1&&(l=D.maxM-1),0==r&&(c=D.minM-1);for(d=0;d<l-c+1;d++)a+="<div class='tooth'>"+(c+d+1)+"</div>";s.innerHTML=a,l<v?(v=l,s.setAttribute("val",v)):v<c&&(v=l,s.setAttribute("val",v)),s.style["-webkit-transform"]="translate3d(0,"+(8-2*(v-c))+"em,0)",s.setAttribute("top",8-2*(v-c)+"em");var o=D.gearDate.querySelector(".date_dd");if(o&&o.getAttribute("val")){a="";var m=parseInt(o.getAttribute("val")),u=b(r,v)-1,g=0;r==e-1&&D.maxM==v+1&&(u=D.maxD-1),0==r&&D.minM==v+1&&(g=D.minD-1);for(d=0;d<u-g+1;d++)a+="<div class='tooth'>"+(g+d+1)+"</div>";o.innerHTML=a,u<m?(m=u,o.setAttribute("val",m)):m<g&&(m=g,o.setAttribute("val",m)),o.style["-webkit-transform"]="translate3d(0,"+(8-2*(m-g))+"em,0)",o.setAttribute("top",8-2*(m-g)+"em")}}}}function l(){var e=D.gearDate.querySelector(".time_hh");if(e&&e.getAttribute("val")){for(var t="",a=parseInt(e.getAttribute("val")),r=0;r<=23;r++)t+="<div class='tooth'>"+r+"</div>";e.innerHTML=t,e.style["-webkit-transform"]="translate3d(0,"+(8-2*a)+"em,0)",e.setAttribute("top",8-2*a+"em");var d=D.gearDate.querySelector(".time_mm");if(d&&d.getAttribute("val")){t="";var i=parseInt(d.getAttribute("val"));for(r=0;r<=59;r++)t+="<div class='tooth'>"+r+"</div>";d.innerHTML=t,d.style["-webkit-transform"]="translate3d(0,"+(8-2*i)+"em,0)",d.setAttribute("top",8-2*i+"em")}}}function b(e,t){return 1==t?(e+=D.minY)%4==0&&e%100!=0||e%400==0&&e%4e3!=0?29:28:3==t||5==t||8==t||10==t?30:31}function c(e){e.preventDefault();for(var t=e.target;!t.classList.contains("gear");)t=t.parentElement;clearInterval(t["int_"+t.id]),t["old_"+t.id]=e.targetTouches[0].screenY,t["o_t_"+t.id]=(new Date).getTime();var a=t.getAttribute("top");t["o_d_"+t.id]=a?parseFloat(a.replace(/em/g,"")):0,t.style.webkitTransitionDuration=t.style.transitionDuration="0ms"}function o(e){e.preventDefault();for(var t=e.target;!t.classList.contains("gear");)t=t.parentElement;t["new_"+t.id]=e.targetTouches[0].screenY,t["n_t_"+t.id]=(new Date).getTime();var a=30*(t["new_"+t.id]-t["old_"+t.id])/window.innerHeight;t["pos_"+t.id]=t["o_d_"+t.id]+a,t.style["-webkit-transform"]="translate3d(0,"+t["pos_"+t.id]+"em,0)",t.setAttribute("top",t["pos_"+t.id]+"em"),e.targetTouches[0].screenY<1&&m(e)}function m(e){e.preventDefault();for(var t=e.target;!t.classList.contains("gear");)t=t.parentElement;var a=(t["new_"+t.id]-t["old_"+t.id])/(t["n_t_"+t.id]-t["o_t_"+t.id]);Math.abs(a)<=.2?t["spd_"+t.id]=a<0?-.08:.08:Math.abs(a)<=.5?t["spd_"+t.id]=a<0?-.16:.16:t["spd_"+t.id]=a/2,t["pos_"+t.id]||(t["pos_"+t.id]=0),function(g){var _=0,h=!1;function y(){g.style.webkitTransitionDuration=g.style.transitionDuration="200ms",h=!0}var p=D.maxY-D.minY+1;clearInterval(g["int_"+g.id]),g["int_"+g.id]=setInterval(function(){var e=g["pos_"+g.id],t=g["spd_"+g.id]*Math.exp(-.03*_);if(e+=t,.1<Math.abs(t));else{var a=2*Math.round(e/2);e=a,y()}switch(8<e&&(e=8,y()),g.dataset.datetype){case"date_yy":var r=8-2*(p-1);if(e<r&&(e=r,y()),h){var d=Math.abs(e-8)/2;f(g,d),clearInterval(g["int_"+g.id])}break;case"date_mm":var i=D.gearDate.querySelector(".date_yy"),n=parseInt(i.getAttribute("val")),s=11,v=0;n==p-1&&(s=D.maxM-1),0==n&&(v=D.minM-1);var r=8-2*(s-v);if(e<r&&(e=r,y()),h){var d=Math.abs(e-8)/2+v;f(g,d),clearInterval(g["int_"+g.id])}break;case"date_dd":var i=D.gearDate.querySelector(".date_yy"),l=D.gearDate.querySelector(".date_mm"),n=parseInt(i.getAttribute("val")),c=parseInt(l.getAttribute("val")),o=b(n,c),m=o-1,u=0;n==p-1&&D.maxM==c+1&&(m=D.maxD-1),0==n&&D.minM==c+1&&(u=D.minD-1);var r=8-2*(m-u);if(e<r&&(e=r,y()),h){var d=Math.abs(e-8)/2+u;f(g,d),clearInterval(g["int_"+g.id])}break;case"time_hh":if(e<-38&&(e=-38,y()),h){var d=Math.abs(e-8)/2;f(g,d),clearInterval(g["int_"+g.id])}break;case"time_mm":if(e<-110&&(e=-110,y()),h){var d=Math.abs(e-8)/2;f(g,d),clearInterval(g["int_"+g.id])}}g["pos_"+g.id]=e,g.style["-webkit-transform"]="translate3d(0,"+e+"em,0)",g.setAttribute("top",e+"em"),_++},30)}(t)}function f(e,t){t=Math.round(t),e.setAttribute("val",t),/date/.test(e.dataset.datetype)?v():l()}function u(e){var t;e.preventDefault();try{t=new CustomEvent("input")}catch(e){(t=document.createEvent("Event")).initEvent("input",!0,!0)}D.trigger.dispatchEvent(t),document.body.removeChild(D.gearDate),D.gearDate=null}function n(e){var t=D.maxY-D.minY+1,a=parseInt(Math.round(D.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(D.gearDate.querySelector(".date_mm").getAttribute("val")))+1;r=9<r?r:"0"+r;var d=parseInt(Math.round(D.gearDate.querySelector(".date_dd").getAttribute("val")))+1;d=9<d?d:"0"+d,D.trigger.value=a%t+D.minY+"-"+r+"-"+d,u(e)}function i(e){var t=D.maxY-D.minY+1,a=parseInt(Math.round(D.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(D.gearDate.querySelector(".date_mm").getAttribute("val")))+1;r=9<r?r:"0"+r,D.trigger.value=a%t+D.minY+"-"+r,u(e)}function g(e){var t=D.maxY-D.minY+1,a=parseInt(Math.round(D.gearDate.querySelector(".date_yy").getAttribute("val"))),r=parseInt(Math.round(D.gearDate.querySelector(".date_mm").getAttribute("val")))+1;r=9<r?r:"0"+r;var d=parseInt(Math.round(D.gearDate.querySelector(".date_dd").getAttribute("val")))+1;d=9<d?d:"0"+d;var i=parseInt(Math.round(D.gearDate.querySelector(".time_hh").getAttribute("val")));i=9<i?i:"0"+i;var n=parseInt(Math.round(D.gearDate.querySelector(".time_mm").getAttribute("val")));n=9<n?n:"0"+n,D.trigger.value=a%t+D.minY+"-"+r+"-"+d+" "+(i.length<2?"0":"")+i+(n.length<2?":0":":")+n,u(e)}function s(e){var t=parseInt(Math.round(D.gearDate.querySelector(".time_hh").getAttribute("val")));t=9<t?t:"0"+t;var a=parseInt(Math.round(D.gearDate.querySelector(".time_mm").getAttribute("val")));a=9<a?a:"0"+a,D.trigger.value=(t.length<2?"0":"")+t+(a.length<2?":0":":")+a,u(e)}D.opener.addEventListener("click",{ym:function(e){D.gearDate=document.createElement("div"),D.gearDate.className="gearDate",D.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="ym_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div></div></div></div>',document.body.appendChild(D.gearDate),t=new Date,a={yy:t.getFullYear(),mm:t.getMonth()},/^\d{4}-\d{1,2}$/.test(D.trigger.value)?(rs=D.trigger.value.match(/(^|-)\d{1,4}/g),a.yy=rs[0]-D.minY,a.mm=rs[1].replace(/-/g,"")-1):a.yy=a.yy-D.minY,D.gearDate.querySelector(".date_yy").setAttribute("val",a.yy),D.gearDate.querySelector(".date_mm").setAttribute("val",a.mm),v(),D.gearDate.querySelector(".lcalendar_cancel").addEventListener("touchstart",u),D.gearDate.querySelector(".lcalendar_finish").addEventListener("touchstart",i);var t,a;var r=D.gearDate.querySelector(".date_yy"),d=D.gearDate.querySelector(".date_mm");r.addEventListener("touchstart",c),d.addEventListener("touchstart",c),r.addEventListener("touchmove",o),d.addEventListener("touchmove",o),r.addEventListener("touchend",m),d.addEventListener("touchend",m)},date:function(e){D.gearDate=document.createElement("div"),D.gearDate.className="gearDate",D.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="date_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div></div></div></div>',document.body.appendChild(D.gearDate),t=new Date,a={yy:t.getFullYear(),mm:t.getMonth(),dd:t.getDate()-1},/^\d{4}-\d{1,2}-\d{1,2}$/.test(D.trigger.value)?(rs=D.trigger.value.match(/(^|-)\d{1,4}/g),a.yy=rs[0]-D.minY,a.mm=rs[1].replace(/-/g,"")-1,a.dd=rs[2].replace(/-/g,"")-1):a.yy=a.yy-D.minY,D.gearDate.querySelector(".date_yy").setAttribute("val",a.yy),D.gearDate.querySelector(".date_mm").setAttribute("val",a.mm),D.gearDate.querySelector(".date_dd").setAttribute("val",a.dd),v(),D.gearDate.querySelector(".lcalendar_cancel").addEventListener("touchstart",u),D.gearDate.querySelector(".lcalendar_finish").addEventListener("touchstart",n);var t,a;var r=D.gearDate.querySelector(".date_yy"),d=D.gearDate.querySelector(".date_mm"),i=D.gearDate.querySelector(".date_dd");r.addEventListener("touchstart",c),d.addEventListener("touchstart",c),i.addEventListener("touchstart",c),r.addEventListener("touchmove",o),d.addEventListener("touchmove",o),i.addEventListener("touchmove",o),r.addEventListener("touchend",m),d.addEventListener("touchend",m),i.addEventListener("touchend",m)},datetime:function(e){D.gearDate=document.createElement("div"),D.gearDate.className="gearDatetime",D.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="datetime_roll"><div><div class="gear date_yy" data-datetype="date_yy"></div><div class="date_grid"><div>年</div></div></div><div><div class="gear date_mm" data-datetype="date_mm"></div><div class="date_grid"><div>月</div></div></div><div><div class="gear date_dd" data-datetype="date_dd"></div><div class="date_grid"><div>日</div></div></div><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>',document.body.appendChild(D.gearDate),t=new Date,a={yy:t.getFullYear(),mm:t.getMonth(),dd:t.getDate()-1,hh:t.getHours(),mi:t.getMinutes()},/^\d{4}-\d{1,2}-\d{1,2}\s\d{2}:\d{2}$/.test(D.trigger.value)?(rs=D.trigger.value.match(/(^|-|\s|:)\d{1,4}/g),a.yy=rs[0]-D.minY,a.mm=rs[1].replace(/-/g,"")-1,a.dd=rs[2].replace(/-/g,"")-1,a.hh=parseInt(rs[3].replace(/\s0?/g,"")),a.mi=parseInt(rs[4].replace(/:0?/g,""))):a.yy=a.yy-D.minY,D.gearDate.querySelector(".date_yy").setAttribute("val",a.yy),D.gearDate.querySelector(".date_mm").setAttribute("val",a.mm),D.gearDate.querySelector(".date_dd").setAttribute("val",a.dd),v(),D.gearDate.querySelector(".time_hh").setAttribute("val",a.hh),D.gearDate.querySelector(".time_mm").setAttribute("val",a.mi),l(),D.gearDate.querySelector(".lcalendar_cancel").addEventListener("touchstart",u),D.gearDate.querySelector(".lcalendar_finish").addEventListener("touchstart",g);var t,a;var r=D.gearDate.querySelector(".date_yy"),d=D.gearDate.querySelector(".date_mm"),i=D.gearDate.querySelector(".date_dd"),n=D.gearDate.querySelector(".time_hh"),s=D.gearDate.querySelector(".time_mm");r.addEventListener("touchstart",c),d.addEventListener("touchstart",c),i.addEventListener("touchstart",c),n.addEventListener("touchstart",c),s.addEventListener("touchstart",c),r.addEventListener("touchmove",o),d.addEventListener("touchmove",o),i.addEventListener("touchmove",o),n.addEventListener("touchmove",o),s.addEventListener("touchmove",o),r.addEventListener("touchend",m),d.addEventListener("touchend",m),i.addEventListener("touchend",m),n.addEventListener("touchend",m),s.addEventListener("touchend",m)},time:function(e){D.gearDate=document.createElement("div"),D.gearDate.className="gearDate",D.gearDate.innerHTML='<div class="date_ctrl slideInUp"><div class="date_btn_box"><div class="date_btn lcalendar_cancel">取消</div><div class="date_btn lcalendar_finish">确定</div></div><div class="date_roll_mask"><div class="time_roll"><div><div class="gear time_hh" data-datetype="time_hh"></div><div class="date_grid"><div>时</div></div></div><div><div class="gear time_mm" data-datetype="time_mm"></div><div class="date_grid"><div>分</div></div></div></div></div></div>',document.body.appendChild(D.gearDate),t=new Date,a={hh:t.getHours(),mm:t.getMinutes()},/^\d{2}:\d{2}$/.test(D.trigger.value)&&(rs=D.trigger.value.match(/(^|:)\d{2}/g),a.hh=parseInt(rs[0].replace(/^0?/g,"")),a.mm=parseInt(rs[1].replace(/:0?/g,""))),D.gearDate.querySelector(".time_hh").setAttribute("val",a.hh),D.gearDate.querySelector(".time_mm").setAttribute("val",a.mm),l(),D.gearDate.querySelector(".lcalendar_cancel").addEventListener("touchstart",u),D.gearDate.querySelector(".lcalendar_finish").addEventListener("touchstart",s);var t,a;var r=D.gearDate.querySelector(".time_hh"),d=D.gearDate.querySelector(".time_mm");r.addEventListener("touchstart",c),d.addEventListener("touchstart",c),r.addEventListener("touchmove",o),d.addEventListener("touchmove",o),r.addEventListener("touchend",m),d.addEventListener("touchend",m)}}[e])}},e}();
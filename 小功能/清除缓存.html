<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>

</body>
<script src="ajax.js"></script>
<script src="libs/jquery-1.9.1.min.js"></script>
<script>
    //1,跨域请求，询问后台是否有更新
    //2，若有更新则执行下列代码
    //    $.ajax({
    //      type: 'GET',
    //      url: './vueStatic/ajax.json',
    //      success: function (res) {
    //        if(res.err_code!==0){alert(res.err_msg);return ;}
    //        if(res.data.update){
    //          updatePage(res.data.manifest,res.data.vendor,res.data.app)
    //        }else{
    //          console.log("不需要更新")
    //        }
    //      },
    //      fail: function (err) {
    //        if(!location.href.includes("localhost")){
    //           alert("网络错误，请刷新页面重试");
    //        }
    //        console.log(err)
    //      }
    //    });

    setTimeout(function () {
        updatePage("http://test.jubao56.com/vueStatic/js/manifest.9593450469f68550fc71.js",
            "http://test.jubao56.com/vueStatic/js/vendor.79255674a371146870b9.js",
            "http://test.jubao56.com/vueStatic/js/app.c5ffc704ecb6b4754732.js")
    }, 2000);

    function updatePage(manifest, vendor, app) {
        var manifestScript = null, vendorScript = null, appScript = null;
        var scripts = document.getElementsByTagName("script");
        var body = document.getElementsByTagName("body")[0];
        for (var i = 0; i < scripts.length; i++) {
            if (manifestScript === null) {
                manifestScript=newScript(scripts[i], "manifest",manifestScript,manifest);
            }
            if (vendorScript === null) {
                vendorScript=newScript(scripts[i], "vendor",vendorScript,vendor)
            }
            if (appScript === null) {
                appScript=newScript(scripts[i], "app",appScript,app)
            }
        }
        //按照顺序书写，保障srcipt标签的引入顺序
        body.appendChild(manifestScript);
        body.appendChild(vendorScript);
        body.appendChild(appScript);
    }

    function newScript(script, params,nameScript,src) { // 删除src中带目标字段的script标签，并返回一个空script
        if (script.src.indexOf(params) !== -1) {//找到目标js，删除掉，替换其src,
            script.parentNode.removeChild(script);
            var tempScript = document.createElement("script");
            tempScript.src=src;
            return tempScript
        }else{
            return null;
        }
    }
</script>
</html>
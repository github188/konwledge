<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        *{margin: 0;padding:0;}
        #box{width:900px;height:500px;border:1px solid #000;position:relative}
        #box .div{width:100px;height:100px;position:absolute}

        .blank{background:white;width:100px;height:100px;position:absolute}
        .wall{background:url(img/wall.jpg) no-repeat center/cover;width:100px;height:100px;position:absolute;}
        .aim{background:url(img/aim.jpg) no-repeat center/cover;width:100px;height:100px;position:absolute}
        .runBox{background:url(img/box.jpg) no-repeat center/cover;width:100px;height:100px;position:absolute}
        .runMan{background:url(img/man.jpg) no-repeat center/cover;width:100px;height:100px;position:absolute}
    </style>
</head>
<body>
    <div id="box">

    </div>
    <!--<select name="select" id="select">-->
        <!--<option value="1">第一关</option>-->
        <!--<option value="2">第二关</option>-->
        <!--<option value="3">第三关</option>-->
        <!--<option value="4">第四关</option>-->
        <!--<option value="5">第五关</option>-->
        <!--<option value="6">第六关</option>-->
    <!--</select>-->
    <button type="button">第一关</button>
    <button type="button">第二关</button>
    <button type="button">第三关</button>
    <button type="button">第四关</button>
    <button type="button">第五关</button>
    <button type="button">第六关</button>

</body>
<script>
    var step = 100
    var box = document.querySelector("#box")
    var btn = document.querySelectorAll("button")

    var roomList = null ;//地图布局，
    var runBox = null ; //盒子的位置
    var runMan = null;  //人的位置



    roomList = [
        [0,0,1,1,1,0,0,0,0],
        [0,1,1,3,3,1,0,0,0],
        [0,1,0,0,0,0,1,0,0],
        [0,1,0,0,0,0,1,0,0],
        [0,1,1,1,1,1,1,0,0]
    ];
    runBox =[ {"x":3,"y":2},{"x":4,"y":2}]//,{"x":3,"y":1},{"x":3,"y":3}
    runMan = {"x":2,"y":2}




   for(var i=0;i<btn.length;i++){
       btn[i].index = (i+1)
       btn[i].onclick = function(){
           var tempIndex = this.index
           switch (tempIndex){
               case 1: roomList = [
                   [0,0,1,1,1,0,0,0,0],
                   [0,1,1,3,3,1,0,0,0],
                   [0,1,0,0,0,0,1,0,0],
                   [0,1,0,0,0,0,1,0,0],
                   [0,1,1,1,1,1,1,0,0]
               ];
                   runBox =[ {"x":3,"y":2},{"x":4,"y":2}]//,{"x":3,"y":1},{"x":3,"y":3}
                   runMan = {"x":2,"y":2};break;
               case 2:  roomList = [
                   [0,1,1,1,1,1,0,0],
                   [0,1,0,0,1,1,1,0],
                   [0,1,0,0,0,0,1,0],
                   [1,1,1,0,1,0,1,1],
                   [1,3,1,0,1,0,0,1],
                   [1,3,0,0,0,1,0,1],
                   [1,3,0,0,0,0,0,1],
                   [1,1,1,1,1,1,1,1]
               ];
                   runBox =[ {"x":3,"y":2},{"x":2,"y":5},{"x":5,"y":6}]//,{"x":3,"y":1},{"x":3,"y":3}
                   runMan = {"x":2,"y":2};
                   drawFloor();
                   drawBox(runBox);
                   break;
               case 3 :
                   roomList = [
                       [0,0,0,1,1,1,1,1,1,0],
                       [0,1,1,1,0,0,0,0,1,0],
                       [1,1,3,0,0,1,1,0,1,1],
                       [1,3,3,0,0,0,0,0,0,1],
                       [1,3,3,0,0,0,0,0,1,1],
                       [1,1,1,1,1,1,0,0,1,0],
                       [0,0,0,0,0,1,1,1,1,0]
                   ];
                   runBox =[ {"x":4,"y":2},{"x":3,"y":3},{"x":4,"y":4},{"x":5,"y":3},{"x":6,"y":4}]//,{"x":3,"y":1},{"x":3,"y":3}
                   runMan = {"x":8,"y":3};
                   drawFloor();
                   drawBox(runBox);
                   break;
               case 4 :
                   roomList = [
                       [0,1,1,1,1,1,1,1,0,0],
                       [0,1,0,0,0,0,0,1,1,1],
                       [1,1,0,1,1,1,0,0,0,1],
                       [1,0,0,0,0,0,0,0,0,1],
                       [1,0,3,3,1,0,0,0,1,1],
                       [1,1,3,3,1,0,0,0,1,0],
                       [0,1,1,1,1,1,1,1,1,0]
                   ];
                   runBox =[ {"x":2,"y":2},{"x":4,"y":3},{"x":6,"y":4},{"x":7,"y":3},{"x":6,"y":4}]//,{"x":3,"y":1},{"x":3,"y":3}
                   runMan = {"x":2,"y":3};
                   drawFloor();
                   drawBox(runBox);
                   break;
               case 5 :
                   roomList = [
                       [0,0,1,1,1,1,0,0],
                       [0,0,1,3,3,1,0,0],
                       [0,1,1,0,3,1,1,0],
                       [0,1,0,0,0,3,1,0],
                       [1,1,0,0,0,0,1,1],
                       [1,0,0,1,0,0,0,1],
                       [1,0,0,0,0,0,0,1],
                       [1,1,1,1,1,1,1,1]
                   ];
                   runBox =[ {"x":4,"y":3},{"x":3,"y":4},{"x":4,"y":5},{"x":5,"y":5}]//,{"x":3,"y":1},{"x":3,"y":3}
                   runMan = {"x":4,"y":6};
                   drawFloor();
                   drawBox(runBox);
                   break;
               case 6 :
                   roomList = [
                       [0,0,0,0,1,1,1,1,1,1,1,0],
                       [0,0,0,0,1,0,0,1,0,0,1,0],
                       [0,0,0,0,1,0,0,0,0,0,1,0],
                       [1,1,1,1,1,0,0,1,0,0,1,0],
                       [3,3,3,1,1,0,0,0,0,0,1,1],
                       [3,0,0,1,0,0,0,0,1,0,0,1],
                       [3,0,0,0,0,0,0,0,0,0,0,1],
                       [3,0,0,1,0,0,0,0,1,0,0,1],
                       [3,3,3,1,1,1,0,1,0,0,1,1],
                       [1,1,1,1,1,0,0,0,0,0,1,0],
                       [0,0,0,0,1,0,0,1,0,0,1,0],
                       [0,0,0,0,1,1,1,1,1,1,1,0]
                   ];
                   runBox =[ {"x":5,"y":6},{"x":6,"y":3},{"x":6,"y":5},{"x":6,"y":7},{"x":6,"y":9},{"x":7,"y":2},{"x":8,"y":2},{"x":9,"y":6}]//,{"x":3,"y":1},{"x":3,"y":3}
                   runMan = {"x":5,"y":10};
                   drawFloor();
                   drawBox(runBox);
                   break;
           }
       }
   }

    // 建立一个数组，来绘制房间
    //房间有四种状态
    //-1表示不摆放，
    //0表示空白
    //1表示墙
    //4就表示箱子需要还原的位置
//     roomList = [
//        [0,0,1,1,1,0,0,0,0],
//        [0,1,1,3,3,1,0,0,0],
//        [0,1,0,0,0,0,1,0,0],
//        [0,1,0,0,0,0,1,0,0],
//        [0,1,1,1,1,1,1,0,0]
//    ];
//    runBox =[ {"x":3,"y":2},{"x":4,"y":2}]//,{"x":3,"y":1},{"x":3,"y":3}
//    runMan = {"x":2,"y":2}

    //参数x,y分别是数组的列和行的序号
    //step是每个小图片的长
    //x表示行（0-9），y表示列（0-10）
    drawFloor()
    drawBox(runBox)


    var divMan = document.createElement("div")
    divMan.className = "runMan"
    divMan.style.left =(runMan["x"])*step +"px"
    divMan.style.top = (runMan["y"])*step +"px"
    box.appendChild(divMan)

    //获取所有的箱子
    var currentBox = document.querySelectorAll(".runBox")
    var wall = document.querySelectorAll(".wall")

    //成功条件


    document.onkeydown = function (e) {
        var evt = window.event || e
        var code = evt.which || evt.code


        if (code == 37) {
            var tempWall = [];
            for (var i = 0; i < wall.length; i++) {
                if (getStyleAttr(divMan, "top") == getStyleAttr(wall[i], "top") && getStyleAttr(divMan, "left") > getStyleAttr(wall[i], "left")) {
                    tempWall.push(wall[i])
                }
            }
            var aimWall = tempWall[tempWall.length - 1]

            var tempBox = []
            for (var i = 0; i < currentBox.length; i++) {
                if (getStyleAttr(divMan, "top") == getStyleAttr(currentBox[i], "top") && getStyleAttr(divMan, "left") > getStyleAttr(currentBox[i], "left")) {
                    tempBox.push(currentBox[i])
                }
            }
            var flag = true
            if (!box1(tempBox)) {

                if (tempBox[0]) {
                    if (getStyleAttr(tempBox[tempBox.length - 1], "left") > (getStyleAttr(aimWall, "left") + 100)) {
                        if (getStyleAttr(divMan, "left") == (getStyleAttr(tempBox[tempBox.length - 1], "left") + 100)) {
                            tempBox[tempBox.length - 1].style.left = getStyleAttr(tempBox[tempBox.length - 1], "left") - step + "px"
                        }
                    } else {
                        if (getStyleAttr(divMan, "left") == (getStyleAttr(tempBox[tempBox.length - 1], "left") + 100) && getStyleAttr(divMan, "top") == getStyleAttr(tempBox[tempBox.length - 1], "top")) {
                            flag = false
                        }
                    }
                }

                //如果遇到墙就不能移动
                if (getStyleAttr(divMan, "left") > (getStyleAttr(aimWall, "left") + 100 ) && flag ) {
                    divMan.style.left = getStyleAttr(divMan, "left") - step + "px"
                    success()
                }
            }

        }
        if (code == 39) {
            var tempWall = [];
            for (var i = 0; i < wall.length; i++) {
                if (getStyleAttr(divMan, "top") == getStyleAttr(wall[i], "top") && getStyleAttr(divMan, "left") < getStyleAttr(wall[i], "left")) {
                    tempWall.push(wall[i])
                }
            }
            var aimWall = tempWall[tempWall.length - 1]

            var tempBox = []
            for (var i = 0; i < currentBox.length; i++) {
                if (getStyleAttr(divMan, "top") == getStyleAttr(currentBox[i], "top") && getStyleAttr(divMan, "left") < getStyleAttr(currentBox[i], "left")) {
                    tempBox.push(currentBox[i])
                }
            }
            var flag = true
            if (!box2(tempBox)) {

                if (tempBox[0]) {
                    if (getStyleAttr(tempBox[tempBox.length - 1], "left") < (getStyleAttr(aimWall, "left") - 100)) {
                        if (getStyleAttr(divMan, "left") == (getStyleAttr(tempBox[0], "left") - 100)) {
                            tempBox[0].style.left = getStyleAttr(tempBox[0], "left") + step + "px"
                        }
                    } else {
                        if (getStyleAttr(divMan, "left") == (getStyleAttr(tempBox[0], "left") - 100) && getStyleAttr(divMan, "top") == getStyleAttr(tempBox[0], "top")) {
                            flag = false
                        }
                    }
                }
                //如果遇到墙就不能移动
                if (getStyleAttr(divMan, "left") < (getStyleAttr(aimWall, "left") - 100 ) && flag) {
                    divMan.style.left = getStyleAttr(divMan, "left") + step + "px"
                    success()
                }
            }
        }

        if (code == 38) {
            var tempWall = [];
            for (var i = 0; i < wall.length; i++) {
                if (getStyleAttr(divMan, "left") == getStyleAttr(wall[i], "left") && getStyleAttr(divMan, "top") > getStyleAttr(wall[i], "top")) {
                    tempWall.push(wall[i])
                }
            }
            var aimWall = tempWall[tempWall.length - 1]

            var tempBox = []
            for (var i = 0; i < currentBox.length; i++) {
                if (getStyleAttr(divMan, "left") == getStyleAttr(currentBox[i], "left") && getStyleAttr(divMan, "top") > getStyleAttr(currentBox[i], "top")) {
                    tempBox.push(currentBox[i])
                }
            }
            var flag = true
            if (!box1(tempBox)) {

                if (tempBox[0]) {
                    if (getStyleAttr(tempBox[tempBox.length - 1], "top") > (getStyleAttr(aimWall, "top") + 100)) {
                        if (getStyleAttr(divMan, "top") == (getStyleAttr(tempBox[tempBox.length - 1], "top") + 100)) {
                            tempBox[tempBox.length - 1].style.top = getStyleAttr(tempBox[tempBox.length - 1], "top") - step + "px"
                        }
                    } else {
                        if (getStyleAttr(divMan, "top") == (getStyleAttr(tempBox[tempBox.length - 1], "top") + 100) && getStyleAttr(divMan, "left") == getStyleAttr(tempBox[tempBox.length - 1], "left")) {
                            flag = false
                        }
                    }
                }

                //如果遇到墙就不能移动
                if (getStyleAttr(divMan, "top") > (getStyleAttr(aimWall, "top") + 100 ) && flag) {
                    divMan.style.top = getStyleAttr(divMan, "top") - step + "px";
                    success()
                }
            }

        }

        if (code == 40) {
            var tempWall = [];
            for (var i = 0; i < wall.length; i++) {
                if (getStyleAttr(divMan, "left") == getStyleAttr(wall[i], "left") && getStyleAttr(divMan, "top") < getStyleAttr(wall[i], "top")) {
                    tempWall.push(wall[i])
                }
            }
            var aimWall = tempWall[tempWall.length - 1]
            var tempBox = []
            for (var i = 0; i < currentBox.length; i++) {
                if (getStyleAttr(divMan, "left") == getStyleAttr(currentBox[i], "left") && getStyleAttr(divMan, "top") < getStyleAttr(currentBox[i], "top")) {
                    tempBox.push(currentBox[i])
                }
            }
            var flag = true
            if (!box2(tempBox)) {

                if (tempBox[0]) {
                    if (getStyleAttr(tempBox[0], "top") < (getStyleAttr(aimWall, "top") - 100)) {
                        if (getStyleAttr(divMan, "top") == (getStyleAttr(tempBox[0], "top") - 100)) {
                            tempBox[0].style.top = getStyleAttr(tempBox[0], "top") + step + "px"
                        }
                    } else {
                        if (getStyleAttr(divMan, "top") == (getStyleAttr(tempBox[0], "top") - 100) && getStyleAttr(divMan, "left") == getStyleAttr(tempBox[0], "left")) {
                            flag = false
                        }
                    }
                }
                //如果遇到墙就不能移动
                if (getStyleAttr(divMan, "top") < (getStyleAttr(aimWall, "top") - 100 ) && flag) {
                    divMan.style.top = getStyleAttr(divMan, "top") + step + "px";
                    success()
                }
            }
        }
    }


    function success() {
        var count = 0;
        for (var i = 0; i < currentBox.length; i++) {
            var endX = getStyleAttr(currentBox[i], "left")/100
            var endY = getStyleAttr(currentBox[i], "top")/100
            if (roomList[endY][endX] == 3) {
                count = count + 1;
            }
        }
        if (count == currentBox.length) {
            alert("成功通关")
        }
    }


    //盒子
    function drawBox(runBox,runMan){
        for(var i=0;i<runBox.length;i++){
            var div = document.createElement("div")
            div.className = "runBox"
            div.style.left =(runBox[i]["x"])*step +"px"
            div.style.top = (runBox[i]["y"])*step +"px"
            box.appendChild(div)
        }
    }

    //画地图
    function drawFloor(){
        // if(roomList[x][y] >= 0){    //-1表示空白，不需要绘制
        //var bitmap = new LBitmap(bitmapDataList[roomList[y][x]]);
        for(var i=0;i<roomList.length;i++){
            for(var j=0;j<roomList[i].length;j++){
                var ele = roomList[i][j]
                var div = document.createElement("div")
                switch (ele){
                    case 0 :div.className = "blank";break;
                    case 1 :div.className = "wall";break;
                    case 3 :div.className = "aim";break;
                }
                div.style.left = j*step +"px"
                div.style.top = i*step +"px"
                box.appendChild(div)
            }
        }
    }

    //getStyleAttr(divMan,"left")== (getStyleAttr(tempBox[tempBox.length-1],"left")+100) && getStyleAttr(divMan,"left")== (getStyleAttr(tempBox[tempBox.length-2],"left")+200)
    function box1(tempBox){
        if( tempBox[tempBox.length-2] ){
            return true
        }else{
            return false
        }
    }

    function box2(tempBox){
        if( tempBox[1] ){
            return true
        }else{
            return false
        }
    }




    function getStyleAttr(ele,attr){
        if(window.getComputedStyle){
            return   parseInt( window.getComputedStyle(ele)[attr] )
        }else{
            return  parseInt( ele.currentStyle[attr] )
        }
    }

</script>
</html>
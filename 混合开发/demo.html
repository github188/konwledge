<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Title</title>
</head>
<body>
<button type="button" id="success">成功</button><br/><br/>
<button type="button" id="fail">失败</button>
<button type="button" id="repeat">重复触发，验证token</button>
</body>
<script>
    //ios传值函数名 orderPayStart  传入参数形式为{token:"10862|vxO1ZZmUB2ZPbo/ERaQUw3GPQPrhHQdLrTPJZeizTIQ8zp9UkDwlmTzEOtQYjtpQmfgWMaqFqY3qsg264jGUUQ==",productType:"zcb",productOrderId:53114};
    //约定订单成功的函数名为 orderPayed
    //约定订单失败的函数名为 orderPayFail

    var btnSuccess = document.getELementById("success");
    var btnFail = document.getELementById("fail");
    var btnRepeat = document.getELementById("repeat");
    var token = null;
    //这是必须要写的，用来初始化一些设置
    function setupWebViewJavascriptBridge(callback) {
        if (window.WebViewJavascriptBridge) { return callback(WebViewJavascriptBridge); }
        if (window.WVJBCallbacks) { return window.WVJBCallbacks.push(callback); }
        window.WVJBCallbacks = [callback];
        var WVJBIframe = document.createElement('iframe');
        WVJBIframe.style.display = 'none';
        WVJBIframe.src = 'wvjbscheme://__BRIDGE_LOADED__';
        document.documentElement.appendChild(WVJBIframe);
        setTimeout(function() { document.documentElement.removeChild(WVJBIframe) }, 0)
    }

    //这也是固定的， OC 调JS ， 需要给OC调用的函数必须写在这个函数里面
    setupWebViewJavascriptBridge(function(bridge) {
        btnSuccess.onclick=function () {
            bridge.callHandler('orderPayed', {res:"支付成功的信息"}, function(response) {

            })
        };
        btnFail.onclick=function () {
            bridge.callHandler('orderPayFail', {res:"支付失败的信息"}, function(response) {

            })
        };

    });

    setupWebViewJavascriptBridge(function(bridge) {
        btnRepeat.onclick=function () {
            bridge.callHandler('orderPayed', {res:"重复触发orderPayed函数",token:token}, function(response) {

            });
            bridge.callHandler('orderPayStart', {res:"触发orderPayStart函数",token:token}, function(response) {

            })
        };
    });

    setupWebViewJavascriptBridge(function(bridge) {
        //data的内容为{token:"10812|RivjqQfd5jl6btvqtgTAWSripLloAKyYl/KmvpVEZt+Oa76djQXhtJ8bAXcjoMX3np7pt0jR8rcKHtWl1XK4FQ==",proType:"zcb",proOrderId:53099}
        bridge.registerHandler('getToken', function(data, responseCallback) {
            token=data.token;
            let responseData={"Javascript Says":'getToken正常接收到app端传值'+ JSON.stringify(data)};
            //给OC的回调
            responseCallback(responseData)
        });
    })

</script>
</html>